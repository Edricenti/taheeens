<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Registration Form</title>
  <link rel="stylesheet" href="style.css">
  <script>
    
    var existingUsers;

    fetch('users.json')
      .then(response => response.json())
      .then(data => existingUsers = data)
      .catch(error => console.error('Error fetching existing users:', error));

    function saveDataToJson() {
      // Convert the existingUsers object to a JSON string
      var jsonData = JSON.stringify(existingUsers);

      // Save the JSON data back to the users.json file
      var blob = new Blob([jsonData], { type: 'application/json' });
      var url = URL.createObjectURL(blob);

      var a = document.createElement('a');
      a.href = url;
      a.download = 'users.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function validateForm() {
      var usernameInput = document.getElementById('usernameInput').value.toLowerCase();
      var emailInput = document.getElementById('emailInput').value.toLowerCase();

      // Check if the entered username or email already exists
      for (var user in existingUsers) {
        if (existingUsers.hasOwnProperty(user)) {
          if (user === usernameInput) {
            alert('Username already exists. Please choose a different username.');
            return false;
          }

          if (existingUsers[user].email.toLowerCase() === emailInput) {
            alert('Email already exists. Please use a different email.');
            return false;
          }
        }
      }

      // Add the new user to the existingUsers object
      existingUsers[usernameInput] = {
        name: usernameInput,
        email: emailInput,
        task1: "Complete a lap in 2:30 - <a href=\"game/level-1.html\">Not completed</a>",
        task2: "Complete a lap in 2:30 - <a href=\"game/level-2.html\">Not completed</a>",
        task3: "Complete a lap in 2:25 - <a href=\"game/level-3.html\">Not completed</a>",
        task4: "Complete a lap in 2:20 - <a href=\"game/level-4.html\">Not completed</a>",
        task5: "Complete a lap in 2:15 - <a href=\"game/level-5.html\">Not completed</a>",
        task6: "Complete a lap in 2:10 - <a href=\"game/level-6.html\">Not completed</a>",
        task7: "Beat your personal goal 6 times.",
        pass: passwordInput
      };

      // Save the updated data to the JSON file
      saveDataToJson();

      alert('Registration successful!');
      return true;
    }
  </script>
</head>
<body>

    <form autocomplete='off' class='form' onsubmit="return validateForm()">
    <div class='control'>
      <h1>
        Sign In
      </h1>
    </div>
    <div class='control block-cube block-input'>
        <input name='Email' placeholder='Email' type="Email" id="emailInput"required>
        <div class='bg-top'>
          <div class='bg-inner'></div>
        </div>
        <div class='bg-right'>
          <div class='bg-inner'></div>
        </div>
        <div class='bg'>
          <div class='bg-inner'></div>
        </div>
      </div>
    <div class='control block-cube block-input'>
      <input name='username' placeholder='Username' type="text" id="usernameInput"required>
      <div class='bg-top'>
        <div class='bg-inner'></div>
      </div>
      <div class='bg-right'>
        <div class='bg-inner'></div>
      </div>
      <div class='bg'>
        <div class='bg-inner'></div>
      </div>
    </div>
    <div class='control block-cube block-input'>
      <input name='password' placeholder='Password' type='password'id="passwordInput"required>
      <div class='bg-top'>
        <div class='bg-inner'></div>
      </div>
      <div class='bg-right'>
        <div class='bg-inner'></div>
      </div>
      <div class='bg'>
        <div class='bg-inner'></div>
      </div>
    </div>
    <button class='btn block-cube block-cube-hover' type='submit'>
      <div class='bg-top'>
        <div class='bg-inner'></div>
      </div>
      <div class='bg-right'>
        <div class='bg-inner'></div>
      </div>
      <div class='bg'>
        <div class='bg-inner'></div>
      </div>
      <div class='text'>
        Register
      </div>
    </button>
    <a href="../level-1.html" style="color: aqua; text-decoration: none; text-align: center;">Go to level 1</a>
  </form>
</body>
</html>
<!--form by Marko-Zub-->